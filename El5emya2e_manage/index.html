<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ - Ø§Ù„Ù†ØªØ§Ø¦Ø¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f7f9fb; }
        .container { max-width: 90rem; }
        .header-gradient { background-image: linear-gradient(to right, #4c51bf, #6b46c1); }
        .table-container::-webkit-scrollbar { height: 8px; }
        .table-container::-webkit-scrollbar-thumb { background-color: #a0aec0; border-radius: 4px; }
    </style>
</head>

<body class="p-4 sm:p-8">

    <header class="header-gradient text-white p-6 rounded-xl shadow-2xl mb-10 container mx-auto">
        <h1 class="text-3xl sm:text-4xl font-extrabold">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</h1>
        <p class="text-lg mt-2 opacity-90">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ù…Ø³ØªØ± Ù…Ø¤Ù…Ù† - Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</p>
    </header>

    <main class="container mx-auto">
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px" id="tabs">
                <li class="mr-2">
                    <a href="index.html" class="inline-block p-4 border-b-2 border-indigo-600 rounded-t-lg font-bold text-indigo-600 hover:text-indigo-700 hover:border-indigo-400 transition">
                        Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
                    </a>
                </li>
                <li class="mr-2">
                    <a href="management.html" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg font-bold text-gray-500 hover:text-indigo-600 hover:border-indigo-400 transition">
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
                    </a>
                </li>
                <li class="mr-2">
                    <a href="students.html" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg font-bold text-gray-500 hover:text-indigo-600 hover:border-indigo-400 transition">
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ğŸ§‘â€ğŸ“
                    </a>
                </li>
                <li class="mr-2">
                    <a href="ranking.html" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg font-bold text-gray-500 hover:text-indigo-600 hover:border-indigo-400 transition">
                        ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ ğŸ†
                    </a>
                </li>
            </ul>
        </div>

        <div id="results-content">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-100 mb-8">
                <h2 class="text-xl font-bold mb-5 text-gray-800">ØªØµÙÙŠØ© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="col-span-full md:col-span-1">
                        <label for="classFilter" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                        <select id="classFilter" class="w-full bg-gray-100 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
                            <option value="g1">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                            <option value="g2">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                            <option value="g3">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                            <option value="s1">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="s2">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="s3">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                        </select>
                    </div>
                    <div class="col-span-full md:col-span-1">
                        <label for="codeSearch" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯</label>
                        <input type="text" id="codeSearch" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-full bg-gray-100 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div class="col-span-full md:col-span-1">
                        <label for="nameSearch" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</label>
                        <input type="text" id="nameSearch" placeholder="Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø§Ø³Ù…" class="w-full bg-gray-100 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div class="col-span-full md:col-span-1">
                        <label for="phoneSearch" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="text" id="phoneSearch" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full bg-gray-100 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div class="col-span-full md:col-span-1 flex items-end">
                        <button id="applyFilterBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition shadow-md">
                            ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (<span id="resultsCount">0</span> Ù†ØªÙŠØ¬Ø©)</h2>
                <div class="table-container overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">#</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø§Ù„ÙƒÙˆØ¯</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø§Ù„Ø§Ø³Ù…</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø§Ù„ØµÙ</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Ø£Ø®Ø·Ø§Ø¡ (ID)</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="8" class="px-6 py-4 text-center text-gray-500" id="loadingRow">... Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Configuration
        const SUPABASE_URL = "https://arbbxmnjviryxkmhwdgk.supabase.co";
        const SUPABASE_SERVICE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmJ4bW5qdmlyeXhrbWh3ZGdrIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjY5NTU0MSwiZXhwIjoyMDc4MjcxNTQxfQ.W5_c_-VqSUhvHmApF_Y4usZfuCwXz0Ci1hxgfO0u8sc";
        const TABLE_RESULTS = "alchemiya_results";
        const TABLE_STUDENTS = "alchemiya_students"; // Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯

        const classNamesMap = {
            'g1': 'Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'g2': 'ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'g3': 'ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ',
            's1': 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ', 's2': 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ', 's3': 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ',
            'Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ': 'g1', 'ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ': 'g2', 'ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ': 'g3',
            'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ': 's1', 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ': 's2', 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ': 's3'
        };

        async function supabaseFetch(method, table, query = '') {
            const url = `${SUPABASE_URL}/rest/v1/${table}${query}`;
            const headers = {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_SERVICE_KEY,
                'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                'Prefer': 'count=exact'
            };
            const response = await fetch(url, { method, headers });
            if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);
            
            const count = response.headers.get('content-range') ? response.headers.get('content-range').split('/')[1] : 0;
            const data = await response.json();
            return { data, count };
        }

        // --- Fetch Results Logic (Modified to link by NAME) ---
        async function fetchResults() {
            const resultsTableBody = document.getElementById('resultsTableBody');
            const resultsCountSpan = document.getElementById('resultsCount');
            const classFilter = document.getElementById('classFilter');
            const nameSearch = document.getElementById('nameSearch');
            const phoneSearch = document.getElementById('phoneSearch');
            const codeSearch = document.getElementById('codeSearch');

            resultsTableBody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-gray-500">... Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ...</td></tr>';
            resultsCountSpan.textContent = '0';

            const selectedClass = classFilter.value;
            const searchName = nameSearch.value.trim();
            const searchPhone = phoneSearch.value.trim();
            const searchCode = codeSearch.value.trim();

            try {
                let resultsData = [];
                let totalCount = 0;

                // 1. Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ (Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰)
                if (searchCode) {
                    // Ø£: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ÙƒÙˆØ¯
                    const studentQuery = `?student_code=eq.${searchCode}&select=student_name`;
                    const { data: students } = await supabaseFetch('GET', TABLE_STUDENTS, studentQuery);

                    if (students.length > 0) {
                        const name = students[0].student_name;
                        if(name) {
                             // Ø¨: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… *Ø§Ù„Ø§Ø³Ù…*
                             const resultQuery = `?student_name=eq.${name}&order=submission_time.desc`;
                             const { data, count } = await supabaseFetch('GET', TABLE_RESULTS, resultQuery);
                             resultsData = data;
                             totalCount = count;
                        } else {
                             resultsTableBody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-red-500">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ„ÙƒÙ† Ø§Ù„Ø§Ø³Ù… ÙØ§Ø±Øº.</td></tr>';
                             return;
                        }
                    } else {
                        resultsTableBody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-gray-500">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯.</td></tr>';
                        return;
                    }

                } else {
                    // 2. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                    let query = `?select=*&order=submission_time.desc`;

                    if (selectedClass !== 'all') {
                        const className = classNamesMap[selectedClass];
                        query += `&class_name=eq.${className}`;
                    }
                    if (searchName) {
                        query += `&student_name=ilike.*${searchName}*`;
                    }
                    if (searchPhone) {
                        query += `&student_phone=ilike.*${searchPhone}*`;
                    }

                    const { data, count } = await supabaseFetch('GET', TABLE_RESULTS, query);
                    resultsData = data;
                    totalCount = count;
                }

                // 3. Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù„Ù„Ø¹Ø±Ø¶
                if (resultsData.length > 0) {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±ÙŠØ¯Ø©
                    const names = [...new Set(resultsData.map(r => r.student_name).filter(n => n))];
                    let nameToCodeMap = {};

                    if (names.length > 0) {
                        // Ø¨Ø³Ø¨Ø¨ Ø§Ø­ØªÙ…Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø±Ø¨ÙŠØ© ÙˆÙ…Ø³Ø§ÙØ§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… encodeURIComponent
                        // Supabase ÙŠØ¯Ø¹Ù… ÙÙ„ØªØ± in.("name1","name2")
                        // Ù„ÙƒÙ† Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ URL Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø£Ùˆ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ©ØŒ Ù…Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø¬Ù„Ø¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆÙ…Ø·Ø§Ø¨Ù‚ØªÙ‡ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ø¯Ø¯ ØµØºÙŠØ±Ø§Ù‹
                        // Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… filter in Ø¨Ø­Ø°Ø±. Ù‡Ù†Ø§ Ø³Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ø§Ø³Ù…Ø§Ø¦Ù‡Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        
                        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø§Ù„Ù€ URL Ù‚Ø¯ ØªØ­Ø¯Ø« Ù…Ø´Ø§ÙƒÙ„ØŒ Ù„Ø°Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø©:
                        // ÙˆÙ‡ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©. Ù„Ù„ØªØ¨Ø³ÙŠØ· Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙ„ØªØ±ØŒ Ù…Ø¹ ØªØ±Ù…ÙŠØ² Ø§Ù„Ù†ØµÙˆØµ.
                        
                        // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹ Ù…Ø¹ Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ GET:
                        const quotedNames = names.map(n => `"${n}"`).join(',');
                        const studentsQuery = `?student_name=in.(${quotedNames})&select=student_name,student_code`;
                        
                        try {
                            const { data: studentsCodes } = await supabaseFetch('GET', TABLE_STUDENTS, studentsQuery);
                            studentsCodes.forEach(s => {
                                if (s.student_name && s.student_code) {
                                    nameToCodeMap[s.student_name] = s.student_code;
                                }
                            });
                        } catch (err) {
                            console.warn("Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø§Ù„Ù€ URLØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ no code ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„", err);
                        }
                    }

                    displayResults(resultsData, nameToCodeMap);
                    resultsCountSpan.textContent = totalCount;
                } else {
                    displayResults([], {});
                    resultsCountSpan.textContent = 0;
                }

            } catch (error) {
                console.error('Error fetching data:', error);
                resultsTableBody.innerHTML = `<tr><td colspan="8" class="px-6 py-4 text-center text-red-500 font-bold">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</div></td></tr>`;
            }
        }

        function displayResults(results, codeMap) {
            const resultsTableBody = document.getElementById('resultsTableBody');
            resultsTableBody.innerHTML = '';
            if (results.length === 0) {
                resultsTableBody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¨Ø­Ø«.</div></td></tr>';
                return;
            }

            results.forEach((result, index) => {
                const percentage = ((result.score / result.total_questions) * 100).toFixed(0);
                let scoreColor = percentage >= 80 ? 'text-green-600 font-extrabold' : (percentage >= 50 ? 'text-yellow-600 font-bold' : 'text-red-600');
                
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø§Ø³Ù…ØŒ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ù†Ø¹Ø±Ø¶ no code
                let studentCode = codeMap[result.student_name];
                let codeDisplay = '';
                
                if (studentCode) {
                    codeDisplay = `<span class="text-indigo-700 font-bold">${studentCode}</span>`;
                } else {
                    codeDisplay = `<span class="text-red-500 text-sm font-bold">no code</span>`;
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition duration-150';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${codeDisplay}</td> <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${result.student_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${result.student_phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-indigo-600">${result.class_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-lg ${scoreColor}">${result.score} / ${result.total_questions} (${percentage}%)</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(result.submission_time).toLocaleString('ar-EG', { dateStyle: 'short', timeStyle: 'short' })}</td>
                    <td class="px-6 py-4 text-sm text-red-400 max-w-xs overflow-hidden text-ellipsis">${result.wrong_questions_ids || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                `;
                resultsTableBody.appendChild(row);
            });
        }

        document.getElementById('applyFilterBtn').addEventListener('click', fetchResults);
        document.getElementById('nameSearch').addEventListener('input', fetchResults);
        document.getElementById('phoneSearch').addEventListener('input', fetchResults);
        document.getElementById('codeSearch').addEventListener('change', fetchResults);
        document.getElementById('classFilter').addEventListener('change', fetchResults);

        // Initial Load
        fetchResults();
    </script>
</body>
</html>