<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ‚Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
         :root {
            --primary: #06b6d4;
            --secondary: #0f172a;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--secondary);
            color: #fff;
            overflow-x: hidden;
            margin: 0;
            min-height: 100vh;
        }
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© */
        
        .video-bg {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -10;
            object-fit: cover;
            filter: brightness(0.3) hue-rotate(190deg);
        }
        /* Ø§Ù„Ø²Ø¬Ø§Ø¬ */
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        /* Ø§Ù„Ù…Ø³ØªØ± Ø§Ù„Ø¹Ø§Ø¦Ù… */
        
        .teacher-container {
            position: fixed;
            bottom: -500px;
            left: 20px;
            z-index: 9999;
            display: flex;
            align-items: flex-end;
            transition: bottom 0.8s ease-in-out;
            pointer-events: none;
        }
        
        .teacher-container.show {
            bottom: -10px;
        }
        
        .teacher-img {
            width: 160px;
            height: auto;
            filter: drop-shadow(0 0 15px rgba(6, 182, 212, 0.6));
            z-index: 2;
        }
        
        .speech-bubble {
            background: #fff;
            color: #000;
            padding: 12px 18px;
            border-radius: 20px 20px 20px 0;
            margin-bottom: 110px;
            margin-left: -30px;
            max-width: 220px;
            font-weight: bold;
            font-size: 0.9rem;
            position: relative;
            z-index: 3;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s ease 0.5s;
            border: 3px solid var(--primary);
            text-align: center;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: var(--primary) transparent;
            display: block;
            width: 0;
        }
        
        .teacher-container.show .speech-bubble {
            opacity: 1;
            transform: scale(1);
        }
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª */
        
        .input-glow:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.5);
        }
        
        .nav-card {
            background: linear-gradient(160deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .nav-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.2);
        }
        
         ::-webkit-scrollbar {
            width: 6px;
        }
        
         ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        
         ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
    </style>
</head>

<body class="flex flex-col items-center pt-10 pb-20">

    <video autoplay muted loop playsinline class="video-bg">
        <source src="https://static.videezy.com/system/resources/previews/000/038/636/original/chemical-reaction.mp4" type="video/mp4">
    </video>

    <div class="teacher-container" id="teacherPopup">
        <img src="stick.png" alt="Mr. Momen" class="teacher-img">
        <div class="speech-bubble" id="teacherMessage">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ø¯ÙŠØŸ ğŸ’ª</div>
    </div>

    <div class="glass-panel w-11/12 max-w-lg rounded-3xl p-6 text-center animate__animated animate__fadeInDown border-t-4 border-cyan-500 mb-8 mt-4">
        <h1 class="text-3xl font-black mb-2 tracking-wide text-cyan-400">
            Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ <span class="text-white text-lg font-normal block mt-1 opacity-90">Ø¹Ù„ÙˆÙ… & Ø¹Ù„ÙˆÙ… Ù…ØªÙƒØ§Ù…Ù„Ø©</span>
        </h1>
        <p class="text-slate-300 text-sm">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨ ğŸš€</p>
    </div>

    <div class="glass-panel w-11/12 max-w-lg rounded-3xl p-6 mb-8 animate__animated animate__fadeInUp">
        <div class="space-y-4">
            <div class="relative">
                <i class="fa-solid fa-user-graduate absolute right-4 top-4 text-cyan-500 text-lg"></i>
                <input id="studentCode" type="number" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-full bg-slate-900/80 text-white pl-4 pr-12 py-3.5 rounded-xl border border-slate-600 input-glow transition-all placeholder-slate-500 text-lg font-bold text-center" onkeypress="checkEnter(event)">
            </div>

            <div class="relative">
                <i class="fa-solid fa-calendar-check absolute right-4 top-4 text-purple-500 text-lg"></i>
                <select id="monthFilter" class="w-full bg-slate-900/80 text-white pl-4 pr-12 py-3.5 rounded-xl border border-slate-600 input-glow transition-all appearance-none cursor-pointer text-center font-bold">
                    <option value="">-- Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø´Ù‡ÙˆØ± --</option>
                    <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option>
                    <option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option><option value="ÙŠÙ†Ø§ÙŠØ±">ÙŠÙ†Ø§ÙŠØ±</option>
                    <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option>
                    <option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option><option value="Ù…Ø§ÙŠÙˆ">Ù…Ø§ÙŠÙˆ</option>
                </select>
                <i class="fa-solid fa-chevron-down absolute left-4 top-5 text-slate-500 text-xs"></i>
            </div>

            <button onclick="searchStudent()" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3.5 rounded-xl shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2">
                <i class="fa-solid fa-rocket"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            </button>
        </div>
    </div>

    <div id="studentInfo" class="w-11/12 max-w-4xl mb-8"></div>

    <div class="grid grid-cols-2 gap-4 w-11/12 max-w-lg">
        <a href="quiz.html" class="nav-card p-5 rounded-2xl text-center group cursor-pointer col-span-2 relative overflow-hidden">
            <div class="w-12 h-12 bg-cyan-900/50 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:bg-cyan-600 transition-colors">
                <i class="fa-solid fa-flask-vial text-2xl text-cyan-400 group-hover:text-white"></i>
            </div>
            <h3 class="font-bold text-gray-100 text-lg">Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
        </a>

        <button onclick="openVideosModal()" class="nav-card p-4 rounded-2xl text-center group cursor-pointer">
            <div class="w-10 h-10 bg-purple-900/50 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:bg-purple-600 transition-colors">
                <i class="fa-solid fa-clapperboard text-xl text-purple-400 group-hover:text-white"></i>
            </div>
            <h3 class="font-bold text-sm text-gray-200">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
        </button>

        <button onclick="openContactsModal()" class="nav-card p-4 rounded-2xl text-center group cursor-pointer">
            <div class="w-10 h-10 bg-green-900/50 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:bg-green-600 transition-colors">
                <i class="fa-brands fa-whatsapp text-xl text-green-400 group-hover:text-white"></i>
            </div>
            <h3 class="font-bold text-sm text-gray-200">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3>
        </button>
    </div>

    <footer class="mt-12 text-slate-500 text-sm pb-8 font-mono">
        <p>Powered By Noveyra</p>
        <p>Created by Abdelrahman Tarek</p>
    </footer>

    <div id="videosModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden items-center justify-center z-50 p-4">
        <div class="glass-panel w-full max-w-2xl rounded-2xl p-6 relative border-t-4 border-purple-500 animate__animated animate__fadeInDown">
            <button onclick="closeVideosModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h2 class="text-2xl font-bold text-center mb-6 text-purple-400">Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h2>
            <select id="videoClassSelect" class="w-full bg-slate-800 text-white p-3 rounded-lg border border-slate-600 mb-4 focus:ring-2 focus:ring-purple-500 outline-none" onchange="filterVideosByClass()">
                <option value="">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>
            </select>
            <div id="videosContainer" class="grid gap-3 max-h-[60vh] overflow-y-auto pr-2"></div>
        </div>
    </div>

    <div id="contactsModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden items-center justify-center z-50 p-4">
        <div class="glass-panel w-full max-w-md rounded-2xl p-6 relative border-t-4 border-green-500 animate__animated animate__fadeInDown">
            <button onclick="closeContactsModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h2 class="text-2xl font-bold text-center mb-6 text-green-400">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h2>
            <div id="contactsContainer" class="space-y-3"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://arbbxmnjviryxkmhwdgk.supabase.co";
        // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠ ÙÙŠ service role
        // Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ Anon Key Ø§Ù„ØµØ­ÙŠØ­ (Ù…Ø£Ø®ÙˆØ° Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmJ4bW5qdmlyeXhrbWh3ZGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2OTU1NDEsImV4cCI6MjA3ODI3MTU0MX0.G-MsJtbQ1LlPZO-Vob6nKzdClHmOYu6RFOKi62FKKNk";

        const TABLE_STUDENTS = "alchemiya_students";
        const TABLE_RECORDS = "alchemiya_records";
        const TABLE_GROUPS = "alchemiya_groups";

        // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù„ØªØ¬Ø§ÙˆØ² CORS
        const CORS_PROXY = "https://api.allorigins.win/raw?url=";
        const SHEET_VIDEOS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=849351073&single=true&output=csv";
        const SHEET_CONTACTS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=218257892&single=true&output=csv";

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function checkEnter(event) {
            if (event.key === 'Enter') searchStudent();
        }

        function safeNumber(val) {
            return (val === "" || val === null || isNaN(parseFloat(val))) ? 0 : parseFloat(val);
        }

        function isEmptyCell(val) {
            return val === null || val === undefined || (typeof val === 'string' && val.trim() === '');
        }

        async function supabaseFetchAnon(table, query) {
            try {
                const url = SUPABASE_URL + '/rest/v1/' + table + (query || '');
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
                    }
                });
                if (!response.ok) return [];
                return await response.json();
            } catch (e) {
                console.error("Supabase Error", e);
                return [];
            }
        }

        async function fetchCSV(url) {
            try {
                // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¸Ø±
                const res = await fetch(CORS_PROXY + encodeURIComponent(url));
                if (!res.ok) return [];
                const text = await res.text();
                const rows = text.trim().split("\n").map(function(r) {
                    return r.split(",");
                });
                const headers = rows[0].map(function(h) {
                    return h.trim();
                });
                return rows.slice(1).map(function(row) {
                    let obj = {};
                    headers.forEach(function(h, i) {
                        obj[h] = row[i] ? row[i].trim() : "";
                    });
                    return obj;
                });
            } catch (e) {
                console.error("CSV Error", e);
                return [];
            }
        }

        // Ø§Ù„Ù…Ø³ØªØ± Ø§Ù„Ø¹Ø§Ø¦Ù…
        const quotes = ["Ø¹Ø§ÙØ± Ø­Ù„Ù…Ùƒ ÙŠØ³ØªØ§Ù‡Ù„! ğŸ’ª", "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ù„Ø¹Ø¨ØªÙ†Ø§ ğŸ§ª", "Ù…ØªØ®Ø§ÙØ´ Ù…Ù† Ø§Ù„ØºÙ„Ø· ğŸš€", "Ø±ÙƒØ² ÙÙŠ Ù‡Ø¯ÙÙƒ ğŸ˜‰", "Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø³Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ ğŸŒŸ"];

        function triggerTeacherPopup() {
            const popup = document.getElementById('teacherPopup');
            const msgBox = document.getElementById('teacherMessage');
            if (popup && msgBox) {
                msgBox.textContent = quotes[Math.floor(Math.random() * quotes.length)];
                popup.classList.add('show');
                setTimeout(function() {
                    popup.classList.remove('show');
                }, 8000);
            }
        }
        setTimeout(triggerTeacherPopup, 3000);
        setInterval(triggerTeacherPopup, 60000);

        // Ø§Ù„Ø¨Ø­Ø«
        async function searchStudent() {
            const code = document.getElementById("studentCode").value.trim();
            const selectedMonth = document.getElementById("monthFilter").value.trim();
            const infoDiv = document.getElementById("studentInfo");

            infoDiv.innerHTML = '<div class="glass-panel p-6 rounded-2xl text-center"><i class="fa-solid fa-atom fa-spin text-cyan-500 text-3xl mb-2"></i><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</p></div>';

            if (!code) {
                infoDiv.innerHTML = '<div class="glass-panel p-4 rounded-xl border border-red-500/50 text-red-300 text-center font-bold">âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</div>';
                return;
            }

            const studentData = await supabaseFetchAnon(TABLE_STUDENTS, '?select=id,student_name,group_id,phone_parent,student_code,' + TABLE_GROUPS + '(group_name,class_name)&student_code=eq.' + code + '&limit=1');

            if (studentData.length === 0) {
                infoDiv.innerHTML = '<div class="glass-panel p-4 rounded-xl border border-red-500/50 text-red-300 text-center font-bold">ğŸš« Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
                return;
            }

            const student = studentData[0];
            let records = await supabaseFetchAnon(TABLE_RECORDS, '?select=lesson_number,attendance,homework_degree,exam_degree,recitation_degree,comprehensive_exam_degree,lesson_month,lesson_date&student_id=eq.' + student.id + '&order=lesson_date.desc');

            if (selectedMonth) {
                records = records.filter(function(r) {
                    return r.lesson_month === selectedMonth;
                });
            }

            if (records.length === 0 && selectedMonth) {
                infoDiv.innerHTML = '<div class="glass-panel p-4 rounded-xl border border-amber-500/50 text-amber-300 text-center font-bold">ğŸ“‚ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙÙŠ ' + selectedMonth + '</div>';
                return;
            }

            let totalScore = 0,
                totalMax = 0,
                attendanceCount = 0;
            let rowsHtml = '';

            records.forEach(function(r, i) {
                const ex = safeNumber(r.exam_degree);
                const rec = safeNumber(r.recitation_degree);
                const hw = safeNumber(r.homework_degree);
                const comp = safeNumber(r.comprehensive_exam_degree);

                totalScore += (ex + rec + hw + comp);

                if (ex >= 0) totalMax += 10;
                if (rec >= 0) totalMax += 10;
                if (hw >= 0) totalMax += 10;
                if (r.comprehensive_exam_degree != null && r.comprehensive_exam_degree !== "") totalMax += 20;

                if (r.attendance === 'Ø­Ø¶Ø±') attendanceCount++;

                const rowClass = i % 2 === 0 ? 'bg-slate-800/30' : 'bg-slate-800/10';

                let hwVal = '<span class="text-slate-600">-</span>';
                if (r.homework_degree != null && r.homework_degree !== "") hwVal = '<span class="text-green-400 font-bold">' + r.homework_degree + '</span>';

                let recVal = '<span class="text-slate-600">-</span>';
                if (r.recitation_degree != null) recVal = r.recitation_degree;

                let exVal = '<span class="text-slate-600">-</span>';
                if (r.exam_degree != null) exVal = r.exam_degree;

                let compVal = '<span class="text-slate-600">-</span>';
                if (r.comprehensive_exam_degree != null && r.comprehensive_exam_degree !== "") compVal = '<span class="text-amber-400 font-bold">' + r.comprehensive_exam_degree + '</span>';

                rowsHtml += '<tr class="' + rowClass + ' border-b border-slate-700/50"><td class="p-3 font-mono text-cyan-500">' + r.lesson_number + '</td><td class="p-3">' + hwVal + '</td><td class="p-3">' + recVal + '</td><td class="p-3">' + exVal + '</td><td class="p-3">' + compVal + '</td></tr>';
            });

            const percent = totalMax > 0 ? ((totalScore / totalMax) * 100).toFixed(1) : 0;
            let pColor = "text-red-400";
            if (percent >= 85) pColor = "text-green-400";
            else if (percent >= 60) pColor = "text-amber-400";

            const grp = student[TABLE_GROUPS] || {};
            const cName = grp.class_name || '-';
            const gName = grp.group_name || '-';

            infoDiv.innerHTML = `
                <div class="glass-panel rounded-3xl p-6 animate__animated animate__zoomIn border-t-4 border-cyan-500">
                    <div class="flex flex-col md:flex-row justify-between items-center border-b border-slate-700 pb-4 mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-white">${student.student_name}</h2>
                            <p class="text-cyan-400 text-sm">${cName} | ${gName}</p>
                        </div>
                        <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-600">
                            <span class="text-xl font-mono font-bold text-white">${student.student_code}</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <div class="bg-slate-800/60 p-3 rounded-xl text-center border border-slate-700">
                            <p class="text-slate-400 text-xs">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</p>
                            <p class="text-lg font-bold text-white">${totalScore} / ${totalMax}</p>
                        </div>
                        <div class="bg-slate-800/60 p-3 rounded-xl text-center border border-slate-700">
                            <p class="text-slate-400 text-xs">Ø§Ù„Ù†Ø³Ø¨Ø©</p>
                            <p class="text-xl font-bold ${pColor}">${percent}%</p>
                        </div>
                        <div class="bg-slate-800/60 p-3 rounded-xl text-center border border-slate-700">
                            <p class="text-slate-400 text-xs">Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                            <p class="text-lg font-bold text-blue-400">${attendanceCount}</p>
                        </div>
                    </div>
                    <h3 class="text-lg font-bold text-slate-300 mb-2">Ø§Ù„ØªÙØ§ØµÙŠÙ„</h3>
                    <div class="overflow-x-auto rounded-xl border border-slate-700 max-h-64 overflow-y-auto">
                        <table class="w-full text-center text-sm">
                            <thead class="bg-slate-900 text-slate-300 sticky top-0">
                                <tr><th class="p-3">#</th><th class="p-3">ÙˆØ§Ø¬Ø¨</th><th class="p-3">ØªØ³Ù…ÙŠØ¹</th><th class="p-3">Ø§Ù…ØªØ­Ø§Ù†</th><th class="p-3">Ø´Ø§Ù…Ù„</th></tr>
                            </thead>
                            <tbody class="text-slate-200">${rowsHtml}</tbody>
                        </table>
                    </div>
                </div>`;
        }

        // Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„
        let videosData = [];

        async function openVideosModal() {
            document.getElementById("videosModal").classList.remove("hidden");
            document.getElementById("videosModal").style.display = "flex";
            const container = document.getElementById("videosContainer");

            if (videosData.length === 0) {
                container.innerHTML = '<p class="text-center text-slate-400 mt-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
                const data = await fetchCSV(SHEET_VIDEOS);
                if (data.length > 0) {
                    videosData = data;
                    const classes = [];
                    data.forEach(function(v) {
                        if (v.class && !classes.includes(v.class.trim())) classes.push(v.class.trim());
                    });

                    const select = document.getElementById("videoClassSelect");
                    select.innerHTML = '<option value="">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</option>';
                    classes.forEach(function(c) {
                        select.innerHTML += '<option value="' + c + '">' + c + '</option>';
                    });
                    filterVideosByClass();
                } else {
                    container.innerHTML = '<p class="text-red-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                }
            }
        }

        function filterVideosByClass() {
            const cls = document.getElementById("videoClassSelect").value;
            const container = document.getElementById("videosContainer");
            let filtered = videosData;

            if (cls) {
                filtered = videosData.filter(function(v) {
                    return v.class && v.class.trim() === cls;
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>';
                return;
            }

            let html = '';
            filtered.forEach(function(v) {
                html += `
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-center hover:border-purple-500 transition mb-2">
                    <div>
                        <h4 class="font-bold text-white text-sm">${v.title}</h4>
                        <p class="text-xs text-slate-400">${v.note || ''}</p>
                    </div>
                    <a href="${v.link}" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs font-bold flex items-center gap-1">
                        Ù…Ø´Ø§Ù‡Ø¯Ø© <i class="fa-solid fa-play"></i>
                    </a>
                </div>`;
            });
            container.innerHTML = html;
        }

        async function openContactsModal() {
            document.getElementById("contactsModal").classList.remove("hidden");
            document.getElementById("contactsModal").style.display = "flex";
            const container = document.getElementById("contactsContainer");
            container.innerHTML = '<p class="text-center text-slate-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';

            const contacts = await fetchCSV(SHEET_CONTACTS);
            if (contacts.length === 0) {
                container.innerHTML = '<p class="text-red-400 text-center">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>';
                return;
            }

            let html = '';
            contacts.forEach(function(c) {
                const isWa = c.type === 'whatsapp';
                const link = isWa ? 'https://wa.me/' + c.number : 'tel:' + c.number;
                const icon = isWa ? 'fa-whatsapp' : 'fa-phone';
                const color = isWa ? 'text-green-400' : 'text-blue-400';

                html += `
                <a href="${link}" target="_blank" class="block bg-slate-800 p-4 rounded-xl border border-slate-700 hover:bg-slate-700 transition flex justify-between items-center mb-3">
                    <span class="font-bold text-slate-200">${c.label}</span>
                    <span class="${color} text-xl"><i class="fa-brands ${icon}"></i></span>
                </a>`;
            });
            container.innerHTML = html;
        }

        function closeVideosModal() {
            document.getElementById("videosModal").classList.add("hidden");
            document.getElementById("videosModal").style.display = "none";
        }

        function closeContactsModal() {
            document.getElementById("contactsModal").classList.add("hidden");
            document.getElementById("contactsModal").style.display = "none";
        }
// ********************* Ø¶Ø¨Ø· Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ *********************
        document.addEventListener('DOMContentLoaded', () => {
            const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
            const currentMonthIndex = new Date().getMonth(); // ÙŠØ¬Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø± Ù…Ù† 0 Ø¥Ù„Ù‰ 11
            const currentMonthName = months[currentMonthIndex]; // ÙŠØ­ÙˆÙ„Ù‡ Ù„Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ

            const monthSelect = document.getElementById("monthFilter");
            if (monthSelect) {
                // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                monthSelect.value = currentMonthName;
                
                // 2. Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±
                monthSelect.disabled = true; 
                
                // 3. ØªØºÙŠÙŠØ± Ø§Ù„Ø´ÙƒÙ„ Ù„ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø£Ù†Ù‡ Ù…ØºÙ„Ù‚ (ØªØºÙ…ÙŠÙ‚ Ø§Ù„Ù„ÙˆÙ†)
                monthSelect.classList.add("opacity-60", "cursor-not-allowed", "bg-slate-700");
            }
        });
    </script>
</body>

</html>


