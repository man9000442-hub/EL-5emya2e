<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³ØªØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
  </head>
  <body class="bg-gray-100 text-gray-900">
    <!-- Header -->
    <header class="p-6 bg-blue-600 text-white shadow-lg text-center">
      <h1 class="text-3xl font-bold animate__animated animate__fadeInDown">
        Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³ØªØ± âœ¨
      </h1>
    </header>

    <main class="p-6 space-y-10">
      <!-- Ø¨Ø­Ø« Ø§Ù„Ø·Ø§Ù„Ø¨ -->
      <section class="bg-white p-6 rounded-2xl shadow-md">
        <h2 class="text-xl font-bold mb-4">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <div class="flex gap-2">
          <input
            id="studentCode"
            type="text"
            placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨"
            class="flex-1 p-2 border rounded-lg"
          />
          <button
            onclick="searchStudent()"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg"
          >
            Ø¨Ø­Ø«
          </button>
        </div>

        <div id="studentInfo" class="mt-6 hidden"></div>
      </section>

      <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
      <section>
        <h2 class="text-xl font-bold mb-4">ğŸ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>
        <div id="videos" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>

      <!-- Ø§Ù„ØªÙˆØ§ØµÙ„ -->
      <section>
        <h2 class="text-xl font-bold mb-4">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„</h2>
        <div id="contacts" class="flex gap-4 flex-wrap"></div>
      </section>
    </main>

    <script>
      // Ø±ÙˆØ§Ø¨Ø· CSV Ù…Ù† Google Sheets (Ø¨Ø¯Ù„ XXX Ø¨Ø§Ù„Ù„ÙŠÙ†ÙƒØ§Øª Ø¹Ù†Ø¯Ùƒ)
      const SHEET_STUDENTS =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=0&single=true&output=csv";
      const SHEET_VIDEOS =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=849351073&single=true&output=csv";
      const SHEET_CONTACTS =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRj2ajSLPIBsAwHwv8qSVX7_5q5I_LATlqKEWkzOIdF_3Em9PmTTWZ8BnXNau0yCNeF1XAx9KX3PLrN/pub?gid=218257892&single=true&output=csv";

      let students = [];
      let videos = [];
      let contacts = [];

      // ØªØ­ÙˆÙŠÙ„ CSV Ù„ JSON
      async function fetchCSV(url) {
        const res = await fetch(url);
        const text = await res.text();
        const [headerLine, ...lines] = text.trim().split("\n");
        const headers = headerLine.split(",");
        return lines.map((line) => {
          const values = line.split(",");
          return headers.reduce((obj, h, i) => {
            obj[h.trim()] = values[i]?.trim();
            return obj;
          }, {});
        });
      }

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      async function loadData() {
        students = await fetchCSV(SHEET_STUDENTS);
        videos = await fetchCSV(SHEET_VIDEOS);
        contacts = await fetchCSV(SHEET_CONTACTS);

        renderVideos();
        renderContacts();
      }

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨
      function searchStudent() {
        const code = document.getElementById("studentCode").value.trim();
        const student = students.find((s) => s.code === code);
        const info = document.getElementById("studentInfo");

        if (!student) {
          info.innerHTML =
            '<p class="text-red-500 font-bold">âš ï¸ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>';
          info.classList.remove("hidden");
          return;
        }

        let grades = "";
        Object.keys(student)
          .filter((k) => k.startsWith("week") || k.startsWith("exam"))
          .forEach((k) => {
            grades += `<td class="border px-2 py-1 ${
              k.startsWith("exam") ? "bg-yellow-100 font-bold" : ""
            }">${student[k]}</td>`;
          });

        info.innerHTML = `
          <div class="p-4 border rounded-lg bg-gray-50 animate__animated animate__fadeIn">
            <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${student.name}</p>
            <p><b>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</b> ${student.group}</p>
            <p><b>Ø§Ù„ØµÙ:</b> ${student.class}</p>

            <div class="mt-4 overflow-x-auto">
              <table class="w-full border text-center">
                <thead class="bg-gray-200">
                  <tr>
                    ${Object.keys(student)
                      .filter((k) => k.startsWith("week") || k.startsWith("exam"))
                      .map((k) => `<th class="border px-2 py-1">${k}</th>`)
                      .join("")}
                  </tr>
                </thead>
                <tbody>
                  <tr>${grades}</tr>
                </tbody>
              </table>
            </div>
          </div>`;
        info.classList.remove("hidden");
      }

      // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
      function renderVideos() {
        const container = document.getElementById("videos");
        container.innerHTML = videos
          .map(
            (v) => `
          <a href="${v.url}" target="_blank" class="p-4 bg-white rounded-xl shadow hover:shadow-lg animate__animated animate__zoomIn">
            <h3 class="font-semibold">${v.title}</h3>
            <p class="text-sm text-gray-500">${v.notes || ""}</p>
          </a>`
          )
          .join("");
      }

      // Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ§ØµÙ„
      function renderContacts() {
        const container = document.getElementById("contacts");
        container.innerHTML = contacts
          .map((c) => {
            const link =
              c.type === "whatsapp"
                ? `https://wa.me/${c.number}`
                : `tel:${c.number}`;
            return `<a href="${link}" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-lg shadow hover:bg-green-600 animate__animated animate__fadeInUp">
              ${c.label}
            </a>`;
          })
          .join("");
      }

      loadData();
    </script>
  </body>
</html>
