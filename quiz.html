<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr Ayman Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .card label {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            display: block;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #FFFFFF;
            color: #1F2937;
            margin-bottom: 0.5rem;
            border: 2px solid #E5E7EB;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
        }
        
        .card label:hover {
            background-color: #F9FAFB;
            border-color: #6366F1;
        }
        
        .card input[type="radio"] { display: none; }
        
        .selected-answer {
            background-color: #4338CA !important;
            border-color: #A5B4FC !important;
            color: white !important;
        }
        
        .correct-answer {
            background-color: #10B981 !important;
            color: white !important;
            border-color: #34D399 !important;
        }
        
        .incorrect-answer {
            background-color: #EF4444 !important;
            color: white !important;
            border-color: #F87171 !important;
        }
        
        .explanation {
            background-color: #FFFBEB;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #F59E0B;
            color: #92400E;
            animation: fadeIn 0.5s;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col items-center p-4 sm:p-6">

    <header class="w-full max-w-4xl text-center bg-gradient-to-r from-blue-400 to-indigo-600 p-6 rounded-3xl shadow-xl mb-8 fade-in text-white">
        <h1 class="text-4xl font-extrabold">Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ</h1>
        <p class="text-xl mt-2 opacity-95">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„</p>
    </header>

    <main id="loginSection" class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl text-center fade-in border border-gray-200">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
        
        <div class="space-y-4 text-right">
            <div>
                <label class="block text-gray-700 font-bold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                <input id="inputCode" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" class="w-full p-3 bg-gray-50 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500 transition">
            </div>
            
            <div>
                <label class="block text-gray-700 font-bold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„</label>
                <input id="inputPhone" type="tel" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full p-3 bg-gray-50 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500 transition">
            </div>
        </div>

        <button id="loginBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg mt-6 transition transform hover:scale-[1.02] shadow-md">
            ØªØ­Ù‚Ù‚ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        </button>
        <p id="loginError" class="text-red-500 mt-4 hidden font-bold text-sm"></p>
    </main>

    <section id="quizSection" class="hidden w-full max-w-4xl mt-8 fade-in">
        <div class="bg-blue-50 border-r-4 border-blue-500 p-4 rounded-lg shadow-sm mb-6 flex justify-between items-center">
            <div>
                <p class="text-blue-900 font-bold text-lg">Ù…Ø±Ø­Ø¨Ø§Ù‹: <span id="displayStudentName" class="text-indigo-700"></span></p>
                <p class="text-blue-700 text-sm">Ø§Ù„ØµÙ: <span id="displayClassName"></span></p>
            </div>
        </div>

        <form id="quizForm" class="space-y-6"></form>
        
        <div id="result" class="mt-6 text-2xl font-bold text-center p-4 bg-green-50 text-green-800 rounded-2xl shadow-lg hidden border-l-8 border-green-400"></div>
        
        <button id="submitBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg mt-6 transition transform hover:scale-[1.02] shadow-md">
            Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        </button>
    </section>

    <footer style="position: relative; z-index: 9999; text-align: center; padding: 40px 0; margin-top: 50px; background: transparent;">
        <div style="background: rgba(255, 255, 255, 0.95); color: #111; max-width: 400px; margin: 0 auto; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border: 1px solid #ddd; padding: 25px;">
            <p style="font-weight: 600; margin-bottom: 15px; font-size: 16px;">
                ØµÙÙ…Ù‘Ù… Ø¨ÙˆØ§Ø³Ø·Ø© <span style="color: #2563eb; font-weight: 700;">Abdelrahman Tarek</span>
            </p>
            <a href="https://wa.me/201094724932" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(to right, #2563eb, #3b82f6); color: #fff; font-weight: 600; font-size: 14px; padding: 10px 18px; border-radius: 9999px; text-decoration: none; box-shadow: 0 2px 10px rgba(0,0,0,0.2); transition: all 0.3s;">
                <i class="fa-solid fa-envelope"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
            </a>
        </div>
    </footer>

    <script>
        // *************************************************************
        // ** Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase **
        // *************************************************************
        const SUPABASE_URL = "https://arbbxmnjviryxkmhwdgk.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmJ4bW5qdmlyeXhrbWh3ZGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2OTU1NDEsImV4cCI6MjA3ODI3MTU0MX0.G-MsJtbQ1LlPZO-Vob6nKzdClHmOYu6RFOKi62FKKNk";
        
        // Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        const TABLE_RESULTS = "alchemiya_results";
        const TABLE_QUIZZES = "alchemiya_quizzes";
        const TABLE_QUESTIONS = "alchemiya_questions";
        const TABLE_STUDENTS = "alchemiya_students";
        const TABLE_GROUPS = "alchemiya_groups";
        // *************************************************************

        let questions = [];
        let correctAnswers = {};
        let explanations = {};
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹
        let currentStudent = {
            name: "",
            phone: "",
            className: "",
            groupId: ""
        };

        // 1. Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
// 1. Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¹Ø¯Ù„Ø© ÙˆÙ…ØµØ­Ø­Ø©)
// 1. Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ ÙÙ‚Ø·)
        async function loginAndFetchQuiz() {
            const codeInput = document.getElementById("inputCode").value.trim();
            const phoneInput = document.getElementById("inputPhone").value.trim(); // Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
            const loginBtn = document.getElementById("loginBtn");
            const errorMsg = document.getElementById("loginError");

            // Ù†ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ØŒ Ù„ÙƒÙ†Ù†Ø§ Ø³Ù†Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ ÙÙ‚Ø·
            if (!codeInput || !phoneInput) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
                return;
            }

            loginBtn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
            loginBtn.disabled = true;
            errorMsg.classList.add("hidden");

            try {
                // *************************************************************
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… student_code ÙÙ‚Ø·
                // Ø­Ø°ÙÙ†Ø§ Ø¬Ø²Ø¡ (&phone=eq...) Ù„Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø±ÙŠØ¯ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
                // *************************************************************
                
                const studentUrl = `${SUPABASE_URL}/rest/v1/${TABLE_STUDENTS}?select=student_name,group_id&student_code=eq.${codeInput}`;
                
                console.log("Request URL:", studentUrl); 

                const studentRes = await fetch(studentUrl, { 
                    method: 'GET',
                    headers: { 
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    } 
                });

                if (!studentRes.ok) {
                    const err = await studentRes.json();
                    console.error("Supabase Error:", err);
                    throw new Error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
                }

                const students = await studentRes.json();

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø£Ù… Ù„Ø§
                if (!students || students.length === 0) {
                    throw new Error("ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                }

                const studentData = students[0];
                
                // *************************************************************
                // Ù‡Ù†Ø§ Ù†Ø£Ø®Ø° Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
                // Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙ: Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                // Ø§Ù„Ù‡Ø§ØªÙ: Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ (phoneInput)
                // *************************************************************
                currentStudent.name = studentData.student_name;
                currentStudent.phone = phoneInput; // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙŠØ¯ÙˆÙŠ
                currentStudent.groupId = studentData.group_id;

                console.log("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨:", currentStudent.name);

                // 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø§Ù„ØµÙ) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… group_id
                const groupUrl = `${SUPABASE_URL}/rest/v1/${TABLE_GROUPS}?select=class_name&id=eq.${studentData.group_id}`;
                const groupRes = await fetch(groupUrl, { headers: { 'apikey': SUPABASE_ANON_KEY } });
                
                if (!groupRes.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.");
                const groups = await groupRes.json();

                if (!groups || groups.length === 0) {
                    throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨.");
                }

                currentStudent.className = groups[0].class_name;
                
                // 3. Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø°Ø§ Ø§Ù„ØµÙ
                await fetchQuestionsFromSupabase(currentStudent.className);

                // 4. Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                document.getElementById("displayStudentName").textContent = currentStudent.name;
                document.getElementById("displayClassName").textContent = currentStudent.className;
                
                showQuestions();
                document.getElementById("loginSection").classList.add("hidden");
                document.getElementById("quizSection").classList.remove("hidden");

            } catch (error) {
                console.error(error);
                errorMsg.textContent = error.message;
                errorMsg.classList.remove("hidden");
                loginBtn.textContent = "ØªØ­Ù‚Ù‚ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±";
                loginBtn.disabled = false;
            }
        }

        // 2. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        async function fetchQuestionsFromSupabase(className) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø­Ø¯Ø« Ø§Ù…ØªØ­Ø§Ù† Ù…ÙÙØ¹Ù‘ÙÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„ØµÙ
            const quizUrl = `${SUPABASE_URL}/rest/v1/${TABLE_QUIZZES}?select=id&class_name=eq.${encodeURIComponent(className)}&is_active=eq.true&order=created_at.desc&limit=1`;

            let response = await fetch(quizUrl, { headers: { 'apikey': SUPABASE_ANON_KEY } });
            const quizzes = await response.json();

            if (!quizzes || quizzes.length === 0) {
                throw new Error(`Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù† Ù…ÙÙØ¹Ù‘ÙÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„ØµÙ "${className}".`);
            }

            const quizId = quizzes[0].id;

            // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const questionsUrl = `${SUPABASE_URL}/rest/v1/${TABLE_QUESTIONS}?select=id,question_text,choice_a,choice_b,choice_c,choice_d,correct_answer,explanation&quiz_id=eq.${quizId}`;
            response = await fetch(questionsUrl, { headers: { 'apikey': SUPABASE_ANON_KEY } });
            
            if (!response.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.");
            const rawQuestions = await response.json();

            questions = rawQuestions.map(q => {
                const correctChoiceLetter = q.correct_answer ? q.correct_answer.toUpperCase() : 'A';
                const correctChoiceText = q[`choice_${correctChoiceLetter.toLowerCase()}`];

                return {
                    id: q.id.toString(),
                    question: q.question_text,
                    choices: [q.choice_a, q.choice_b, q.choice_c, q.choice_d],
                    correct: correctChoiceText,
                    explanation: q.explanation || ''
                };
            });
        }

        // Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡
        document.getElementById("loginBtn").addEventListener("click", loginAndFetchQuiz);

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
        function showQuestions() {
            const form = document.getElementById("quizForm");
            form.innerHTML = "";
            questions.forEach((q, index) => {
                correctAnswers[q.id] = q.correct;
                explanations[q.id] = q.explanation;

                let choicesHtml = q.choices.map((c) => `
                <label>
                    <input type="radio" name="${q.id}" value="${c}">
                    <span>${c}</span>
                </label>
            `).join("");

                let html = `
                <div class="card bg-white p-5 rounded-2xl shadow-lg border border-gray-200 fade-in" style="animation-delay: ${index * 100}ms;">
                    <p class="font-bold text-lg mb-4 text-gray-800">${index + 1}. ${q.question}</p>
                    <div class="choices space-y-2">${choicesHtml}</div>
                </div>
            `;
                form.innerHTML += html;
            });

            form.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', (event) => {
                    const parent = event.target.closest('.choices');
                    parent.querySelectorAll('label').forEach(label => label.classList.remove('selected-answer'));
                    event.target.parentElement.classList.add('selected-answer');
                });
            });
        }

        // Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        document.getElementById("submitBtn").addEventListener("click", async(e) => {
            e.preventDefault();
            
            // ØªØ£ÙƒÙŠØ¯ Ø¨Ø³ÙŠØ· Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø±Ø³Ø§Ù„
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§ØªØŸ")) return;

            document.getElementById("submitBtn").disabled = true;
            document.getElementById("submitBtn").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ­ÙŠØ­...";

            let score = 0, wrong = [], total = questions.length;
            
            questions.forEach(q => {
                const selectedRadio = document.querySelector(`input[name="${q.id}"]:checked`);
                const card = document.querySelector(`input[name="${q.id}"]`).closest('.card');

                // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                document.querySelectorAll(`input[name="${q.id}"]`).forEach(opt => {
                    const label = opt.parentElement;
                    label.classList.remove('selected-answer');
                    if (opt.value === q.correct) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selectedRadio) {
                    const selectedLabel = selectedRadio.parentElement;
                    if (selectedRadio.value === q.correct) {
                        score++;
                    } else {
                        selectedLabel.classList.add('incorrect-answer');
                        wrong.push(q.id);
                        if (q.explanation) addExplanation(card, q.explanation);
                    }
                } else {
                    wrong.push(q.id);
                    if (q.explanation) addExplanation(card, q.explanation);
                }
            });

            function addExplanation(card, text) {
                if (card.querySelector('.explanation')) return; 
                const exp = document.createElement("div");
                exp.className = "explanation";
                exp.innerHTML = `<b>ğŸ’¡ Ø§Ù„Ø´Ø±Ø­:</b> ${text}`;
                card.appendChild(exp);
            }

            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = `âœ… Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score} / ${total}`;
            resultDiv.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById("submitBtn").style.display = 'none';

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ù† Ø®Ø·ÙˆØ© Ø§Ù„Ø¯Ø®ÙˆÙ„
                const dataToSubmit = {
                    student_name: currentStudent.name,  // Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    student_phone: currentStudent.phone, // Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¯Ø®Ù„
                    class_name: currentStudent.className, // Ø§Ù„ØµÙ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    score: score,
                    total_questions: total,
                    wrong_questions_ids: wrong.join(',')
                };

                const response = await fetch(`${SUPABASE_URL}/rest/v1/${TABLE_RESULTS}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "apikey": SUPABASE_ANON_KEY,
                        "Prefer": "return=minimal"
                    },
                    body: JSON.stringify(dataToSubmit)
                });

                if (!response.ok) {
                    console.error('Failed to save result:', response.status);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŒ Ù„ÙƒÙ† ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­.");
                } else {
                    console.log('Result saved!');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
